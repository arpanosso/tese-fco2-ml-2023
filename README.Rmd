---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, warning = FALSE, error = FALSE, message = FALSE,
  comment = "#>"
)
```

# EMISSÃO DE CO~2~ DO SOLO EM ÁREAS AGRÍCOLAS: ABORDAGEM EM APRENDIZADO DE MÁQUINA ESTATÍSTICO

## Autor: Prof. Dr. [Alan Rodrigo Panosso](https://www.fcav.unesp.br/#!/alan)
##### E-mail: alan.panosso@unesp.br 
##### Departamento de Engenharia e Ciências Exatas
##### UNESP - Câmpus de Jaboticabal

## Objetivo

O objetivo do repositório `tese-fco2-ml-2023` é promover a transparência, a reprodutibilidade e a colaboração em pesquisa. Você é incentivado a explorar o código-fonte, utilizar os dados e contribuir com melhorias, se desejar. Sinta-se à vontade para entrar em contato caso tenha alguma dúvida ou precise de mais informações sobre minha pesquisa.

## Contribuições

Contribuições são bem-vindas! Se você deseja colaborar com melhorias nos códigos, correções de erros ou qualquer outro aprimoramento, sinta-se à vontade para abrir uma solicitação de `pull request`.

## Licença

Este projeto é licenciado sob `MIT License`. Consulte o arquivo [LICENSE](https://github.com/arpanosso/tese-fco2-ml-2023/blob/master/LICENSE.md) para obter mais detalhes.

## Base de dados

Apresentação do pacote `fco2r` construído para  facilitar a divulgação e análise dos resultados obtidos ao longo de mais de 20 anos de ensaios em campo. Este pacote, permite a visualização dos dados, a execução de análises estatísticas avançadas e a geração de gráficos interativos para tornar os resultados mais acessíveis e compreensíveis para a comunidade científica.

### Intalação

Você pode instalar uma versão de desenvolvimento do pacote `fco2r` a partir do [GitHub](https://github.com/) com os seguintes comandos:

```{r,eval=FALSE}
# install.packages("devtools")
# devtools::install_github("arpanosso/fco2r")
```

### Problemas na instalação:

Possíveis problemas na instalação do pacote podem ser sanados com os seguintes comandos:

```{r}
# Sys.getenv("GITHUB_PAT")
# Sys.unsetenv("GITHUB_PAT")
# Sys.getenv("GITHUB_PAT")
```

### Carregando os pacotes

```{r}
library(fco2r)
library(tidyverse)
library(patchwork)
library(ggspatial)
```


### Conhecendo a base de dados de emissão de CO~2~ do solo

Base proveniente de ensaios de campo.

```{r}
help(data_fco2)
glimpse(data_fco2)
```


Vamos conhecer, um pouco mais a nossa base de dados.

```{r}
skimr::skim(data_fco2)
```

### Alguns gráficos a respeito de nossa variável alvo, emissão de CO~2~ do solo (FCO~2~).

```{r,fig.width=15, fig.height=10}
theme_set(theme_bw())
fco2_histograma <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(x=FCO2, y=..density..)) +
  geom_histogram(col="black",fill="gray") +
  geom_density(fill="blue",alpha=.08)

fco2_boxplot <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(x=FCO2)) +
  geom_boxplot(fill="lightgray") + 
  coord_cartesian(ylim=c(-.9,.9))

fco2_qqplot <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(sample=FCO2)) +
  stat_qq(shape=1,size=1,color="black")+
  stat_qq_line(col="red")

fco2_qqplot | (fco2_histograma)/(fco2_boxplot)
```

### Aplicando a transformação logarítmica nos dados de FCO~2~

```{r,fig.width=15, fig.height=10}
ggplot2::theme_set(theme_bw())

fco2_histograma <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(x=log(FCO2), y=..density..)) +
  geom_histogram(col="black",fill="gray") +
  geom_density(fill="red",alpha=.08)

fco2_boxplot <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(x=log(FCO2))) +
  geom_boxplot(fill="orange") + 
  coord_cartesian(ylim=c(-.9,.9))

fco2_qqplot <- data_fco2 %>% 
  drop_na() %>% 
  ggplot(aes(sample=log(FCO2))) +
  stat_qq(shape=1,size=1,color="black")+
  stat_qq_line(col="blue")

fco2_qqplot | (fco2_histograma)/(fco2_boxplot)
```

```{r}
# brasil_geobr <- geobr::read_country()
# estados <- read_state(code_state = "all")
# write_rds(estados,"data/estados.rds")
# write_rds(brasil_geobr,"data/brasil_geobr.rds")
estados <- read_rds("data/estados.rds")
```


```{r}
# muni <- read_municipality()
# write_rds(muni,"data/municipios.rds")
muni <- read_rds("data/municipios.rds")

sp <- muni %>% 
  filter(abbrev_state == "SP")

ms <- muni %>% 
  filter(abbrev_state == "MS")

sp_ms <- muni %>% 
  filter(abbrev_state == "SP" | abbrev_state == "MS")

fsp<-if_else(sp$name_muni == "Jaboticabal" | 
             sp$name_muni == "Guariba" |
             sp$name_muni == "Padrópolis" |
             sp$name_muni == "Rincão"|
             sp$name_muni == "Mococa"|
             sp$name_muni == "Ilha Solteira"
             ,"red","lightyellow")

fms<-if_else(ms$name_muni == "Aparecida Do Taboado" | 
             ms$name_muni == "Selvíria"|
             ms$name_muni == "Dourados"   
             ,"red","lightyellow")

sp_ <- estados %>% 
      filter(abbrev_state == "SP")

ms_ <- estados %>% 
      filter(abbrev_state == "MS")

ggplot(sp_ms) + 
  geom_sf(fill="lightyellow")+
  theme_minimal() + 
  annotation_scale(location="bl")+
  annotation_north_arrow(location="tr",
                         style = north_arrow_nautical(),
                         width = unit(2,"cm"),
                         height = unit(2,"cm")) +
  geom_sf(data= sp, fill=fsp,col=fsp) +
  geom_sf(data=sp_,fill="transparent") +
  geom_sf(data= ms, fill=fms,col=fms) +
  geom_sf(data=ms_,fill="transparent")
```

### Conhecendo a base de dados de concentração de CO~2~ atmosférico, oriundo do sensor NASA-OCO2.
```{r}
help(oco2_br)
glimpse(oco2_br)
```

### Breve resumo do banco de dados de X~CO2~
```{r}
skimr::skim(oco2_br)
```

### Manipulando a base `oco2_br` para criação das variáveis temporais e ajuste de unidade de xco2.

```{r}
oco2_br <- oco2_br  %>% 
        mutate(
           xco2 = xco2_moles_mole_1*1e06,
           data = ymd_hms(time_yyyymmddhhmmss),
           ano = year(data),
           mes = month(data),
           dia = day(data),
           dia_semana = wday(data))
```

Mapa das leituras do satélite OCO2-NASA

```{r}
source("R/graficos.R")
brasil_geobr <- read_rds("data/brasil_geobr.rds")
brasil_geobr %>% 
  ggplot() +
  geom_sf(fill="white", color="black",
          size=.15, show.legend = FALSE) +
  tema_mapa() +
  geom_point(data=oco2_br %>%  
                        sample_n(20000) ,
             aes(x=longitude,y=latitude),
             shape=1,
             col="red",
             alpha=01)+
  labs(x="Longitude",y="Latitude")
```


```{r,fig.width=15, fig.height=10}
xco2_histograma <- oco2_br %>% 
  drop_na() %>% 
  ggplot(aes(x=xco2, y=..density..)) +
  geom_histogram(col="black",fill="gray") +
  geom_density(fill="aquamarine2",alpha=.08)

xco2_boxplot <- oco2_br %>% 
  drop_na() %>% 
  ggplot(aes(x=xco2)) +
  geom_boxplot(fill="aquamarine4") + 
  coord_cartesian(ylim=c(-.9,.9))

xco2_qqplot <- oco2_br %>% 
  drop_na() %>% 
  ggplot(aes(sample=xco2)) +
  stat_qq(shape=1,size=1,color="black")+
  stat_qq_line(col="purple",lwd=2)

xco2_qqplot | (xco2_histograma)/(xco2_boxplot)
```
